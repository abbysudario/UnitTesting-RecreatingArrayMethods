<script src="../simpletest.js"></script>
<script>

//Prototype Implementation:
  //function map(array, callback, optionalThis) {
  //   for (let i = 0; array.length; i++){
  //     callback(array[i]);
  //   }
  // }

//Function signature:
  //arr.map(function callback( currentValue[, index[, array]]) {
    // return element for new_array
  //}[, thisArg])

//Callback parameters:
  //currentValue
  //index is optional
  //array is optional
 
//Return Value: 
  //A new array with each element being the result of the callback function.

//Description: 
  //map calls a provided callback function once for each element in an array, in order, and constructs a new array from the results. callback is invoked only for indexes of the array which have assigned values (including undefined).


function map (array, callback, optionalThis) {
  const length = array.length;
  let mapCallback = callback;

  //if optionalThis Argument is present
  if (optionalThis) {
    mapCallback = callback.bind(optionalThis)
  }

  let mappedArray = [];
  
  for (let i = 0; i < length; i++) {
    if (i in array) {
      mappedArray[i] = mapCallback(array[i], i, array);
    }
    
  }

  return mappedArray;
}

tests ({
    'It should run the callback function array.length times.': function () {
        let numberOfTimesCallbackHasRun = 0;
        map([1,2,3], function () {
            numberOfTimesCallbackHasRun++;
        });
        eq(numberOfTimesCallbackHasRun, 3);
    },
     'It should pass in the ith element as the first argument to the callback.': function () {

        map([1], function (number) {
        eq(number, 1);
        });
        
    },
     'It should pass in the ith position as the second argument to the callback.': function () {
        map([1], function (number, index) {
        eq(index, 0);
        });
         
    },
     'It should pass in the original Array as the third argument to the callback.': function () {
        const testArray = [1,2,3];
        map(testArray, function (number, index, originalArray) {
        eq(originalArray, testArray);
        });
    
    },
     'It should accept an optional this object.': function () {
        map([1], function () {
        eq(this.description, 'I should be accessible inside the of the callback.');
        }, {description: 'I should be accessible inside the of the callback.'});
         
    },

     'It should return an array.': function () {
        let mappedArray = map([], function () {});
        eq(Array.isArray(mappedArray), true);
          
    },

     'It should return a new array, not the originalArray.': function () {
        const originalArray = [];
        const mappedArray = map(originalArray, function () {});
        eq(mappedArray !== originalArray, true);
      
        
    },
     'It should return a mapped array.': function () {
          let mappedArray = map([1], function (number) {
            return number * 4;
          })
          eq(mappedArray[0], 4);
     
    },
    'It should skip unassigned indexes.': function () {
      const weirdArray = [, 1];
      let mappedArray = map(weirdArray, function double(number) {
        return number * 2;
      });
      eq(0 in mappedArray, false);
      eq(mappedArray[1], 2);
    }


});

</script>